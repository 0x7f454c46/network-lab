# -*- yaml -*-
---
global:
  config:
    router-id: 0.0.0.2
    as: 65000
  apply-policy:
    config:
      import-policy-list:
        - import-public
        - import-private
      export-policy-list:
        - export-public
        - export-private
      default-import-policy: "reject-route"
      default-export-policy: "reject-route"

neighbors:
  - config:                     # HV1
      neighbor-address: 172.22.15.201
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 172.22.15.226
  - config:                     # HV2
      neighbor-address: 172.22.15.202
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 172.22.15.226
  - config:                     # HV3
      neighbor-address: 172.22.15.203
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 172.22.15.226

  - config:                     # HV1
      neighbor-address: 198.51.100.201
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 198.151.100.226
  - config:                     # HV2
      neighbor-address: 198.51.100.202
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 198.151.100.226
  - config:                     # HV3
      neighbor-address: 198.51.100.203
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 198.151.100.226
  - config:                     # internet
      neighbor-address: 198.51.100.254
      peer-as: 65000
    route-reflector:
      config:
        route-reflector-client: true
        route-reflector-cluster-id: 198.151.100.226

# We only have one GoBGP instance and one global RIB. We ensure we
# only advertise the correct routes to each peer.

defined-sets:
  neighbor-sets:
    - neighbor-set-name: public
      neighbor-info-list:
        - 198.51.100.201
        - 198.51.100.202
        - 198.51.100.203
        - 198.51.100.254
    - neighbor-set-name: private
      neighbor-info-list:
        - 172.22.15.201
        - 172.22.15.202
        - 172.22.15.203
  bgp-defined-sets:
    community-sets:
      - community-set-name: public
        community-list:
          - "65000:90"
      - community-set-name: private
        community-list:
          - "65000:20"

policy-definitions:
  - name: import-public
    statements:
      - name: import-public
        conditions:
          match-neighbor-set:
            neighbor-set: public
        actions:
          route-disposition:
            accept-route: true
          bgp-actions:
            set-community:
              options: add
              set-community-method:
                communities-list:
                  - "65000:90"
  - name: export-public
    statements:
      - name: export-public
        conditions:
          match-neighbor-set:
            neighbor-set: public
          bgp-conditions:
            match-community-set:
              community-set: public
        actions:
          route-disposition:
            accept-route: true
  - name: import-private
    statements:
      - name: import-private
        conditions:
          match-neighbor-set:
            neighbor-set: private
        actions:
          route-disposition:
            accept-route: true
          bgp-actions:
            set-community:
              options: add
              set-community-method:
                communities-list:
                  - "65000:20"
  - name: export-private
    statements:
      - name: export-private
        conditions:
          match-neighbor-set:
            neighbor-set: private
          bgp-conditions:
            match-community-set:
              community-set: private
        actions:
          route-disposition:
            accept-route: true
